# Active Directory Hardening
## Task 1: Introduction
### Learing Objectives
* Secure Authetication Methods
* Securing hosts through Group Plocies
* Implementing Least Privilege Model
* Protecting against known AD Attacks
* Recovery Plan (Post-compromise scenario)

### Connecting to the Machine
* **IP**: ```[WILL BE PROVIDED]```
* **USERNAME**: ```Amdinistrator```
* **PASSWORD**: ```tryhackmewouldnotguess1@```

## Understanding General Active Directory Concepts
#### Domain
* acts as a core unit regarding the logical structure of the **_Active Directory_**
* initially stores all the critical information about the objects that belong to the domain only

#### Domain Controller
* is an **_AD_** server that acts as the brain for a Windows server domain (can also have Linux and MacOS endpoints)
* acts as a gatekeeper for users' **_Authentication_** & IT resources **_Authorisation_**


![image](https://github.com/user-attachments/assets/ec4ba2f8-b59d-449f-b52d-947da6381f64)


### Trees & Forests

![image](https://github.com/user-attachments/assets/b693ca78-54e0-48ca-88a9-a8f7f264eb07)


#### Trees
* are responsible for sharing resources between the domains
* communicatoin between domains inside of a **_Tree_** can be either **_one-way or two-way communication_**
* when a domain is added to a **_Tree_**, it becomes a **_Parent Domain_**
    * any subsequent domains added to this **_Parent Domains_** is an **_Offspring_**

#### Forests
* is when the sharing of the standard global catalogue, directory schema, logical structure, & directory configuration betweens the collection of trees

### Trust in AD
* is an established communication bridge between the domains in AD
* when trust is established, resources can be shared with other domain(s)
* **_AD Trusts_** are categorized in two ways:

![image](https://github.com/user-attachments/assets/e6499abf-4570-45ad-8c8b-f68790391824)


#### What is the root domain in the attached AD machine?
```
tryhackme.loc
```


## Task 3: Securing Authentication Methods
### LAN Manager Hash
* instead of a user's password being stored in clear text, it is stored with 2 types of hash representation
* if the user's password is less than or equal to 15 characters, both **_LM Hash_** and **_NT Hash_** are generated by **_Windows_**
* **_LM Hash_** is weak and susceptible to brute force attacks
* best practice is to prevent **_Windows_** from storing the password's **_LM Hash_** with the following steps:
```
Group Policy Management Editor >
Computer Configuration >
Policies >
Windows Settings >
Security Settings >
Local Policies >
Security Options >
double click Network security - Do not store LM hash value on next password change policy >
select "Define policy setting"
```

### SMB Signing
* **_Server Message Block_** is generally utilized for **_Microsof_** networks to share file and print communication
* it allows for secure tansmission over the network
* configuring **_SMB Signing_** is crucial to detect **_Man-in-the-Middle (MiTM)_** attacks
* this feature ensures integrity of both data and client
* this can be configured by the following steps:
```
Group Policy Management Editor >
Computer Configuration >
Policies >
Windows Settings >
Security Settings >
Local Policies >
Security Options >
double click Microsoft network server: Digitally sign communication (always) >
select Enable Digitally Sign Communications
```

### LDAP Signing
* **_Lightweight Directory Access Protocol (LDAP)_** enables locating & **_Authenticating_** resources in a network
* also susceptible to **_MiTM_** attacks
* is a **_Simple AUthentication & Security Layer (SASL)_** that only accepts signed **_LDAP_** request and ignores other requests
* this can be configured by the following:
```
Group Policy Management Editor >
Computer Configuration >
Policies >
Windows Settings >
Security Settings >
Local Policies >
Security Options >
Domain controller: LDAP server signing requirements >
select Require signing from the dropdown
``` 

### Password Rotation
#### First Technique
* creating a script to update passwords automatically in the **_Scheduled Task_** with the help of **_PowerShell_**
* does not require additional overhead & removes all the manual efforts for password rotation
* does require you to write & maintain your script

#### Second Technique
* add a **_Multi-Factor Authentication (MFA)_** solution to **_AD_**
* adds an additional layer of security & users will not need to change their passwords as often

#### Third Technique
* use the **_Microsoft_** provided solution for services account password rotation through **_Group Managed Services Accounts (gMSAs)
* this will change passwords every 30 days

### Password Policies
* critical to maintain a strict password policy to help defend against various attacks
* you can modify the default password policy in **_Group Policy Management Editor_** with the following steps:
```
Group Policy Management Editor >
Computer Configuration >
Policies >
Windows Settings >
Security Settings >
Account Policies >
Password Policy
```

### Understanding Password Policy Settings
* **Enforce Password History**: prevents users from using at least 10 to 15 previous passwords
* **Minimum Password Length**: should be between 10 to 14 characters
* **Complexity Requirements**: must not contain the name of the user account & ensures the password has uppercase, lowercase letters, digits, & special characters

#### What is the default minimum password length in the attached VM?
```
7
```

Task 4: Implementing Least Privilege Model




















